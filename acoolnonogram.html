<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Cool Nonogram Solver</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 
      CSS styles for the final design with theming.
    -->
    <style>
        /* --- Base Variables & Structure --- */
        :root {
            --border-color: #CCCCCC;
            --text-color: #333;
            --container-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: #ccc;
            --status-color: #555;
            --font-main: 'Inter', sans-serif;
            --font-display: 'Inter', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 2em;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            transition: background-color 0.3s ease;
        }

        /* --- Theme Definitions --- */
        .theme-plain {
            --background-color: #f7f9fc;
            --primary-color: #4a90e2;
            --primary-glow: rgba(74, 144, 226, 0.2);
            --filled-color: #333333;
            --empty-color: #FFFFFF;
        }
        
        .theme-plain-dark {
            --background-color: #212529;
            --container-bg: #343a40;
            --input-bg: #495057;
            --input-border: #6c757d;
            --border-color: #495057;
            --text-color: #f8f9fa;
            --primary-color: #adb5bd;
            --primary-glow: rgba(173, 181, 189, 0.2);
            --filled-color: #f8f9fa;
            --empty-color: #495057;
            --status-color: #adb5bd;
        }

        .theme-neon-dark {
            --font-main: 'Orbitron', sans-serif;
            --font-display: 'Orbitron', sans-serif;
            --filled-color: #ff00e5;
            --empty-color: #222222;
            --border-color: #444444;
            --background-color: #000000;
            --container-bg: #111111;
            --input-bg: rgba(0,0,0,0.3);
            --input-border: #444444;
            --text-color: #e0e0e0;
            --primary-color: #00f5d4;
            --primary-glow: rgba(0, 245, 212, 0.5);
            --status-color: var(--primary-color);
        }
        
        .theme-neon-light {
            --font-main: 'Orbitron', sans-serif;
            --font-display: 'Orbitron', sans-serif;
            --filled-color: #ff00e5;
            --empty-color: #e9ecef;
            --border-color: #ced4da;
            --background-color: #f8f9fa;
            --container-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: #ced4da;
            --text-color: #ff00e5;
            --primary-color: #0d6efd;
            --primary-glow: rgba(13, 110, 253, 0.3);
            --status-color: #0d6efd;
        }

        /* --- Component Styles --- */
        .container {
            background: var(--container-bg);
            padding: 2em;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 900px;
            transition: background-color 0.3s, border-color 0.3s;
        }

        h2 {
            text-align: center;
            margin-top: 0;
            color: var(--primary-color);
            font-family: var(--font-display);
            text-shadow: 0 0 5px var(--primary-glow);
            transition: color 0.3s, text-shadow 0.3s;
        }

        table {
            border-collapse: collapse;
            margin: 2em auto;
        }

        td {
            border: 1px solid var(--border-color);
            text-align: center;
            vertical-align: middle;
            transition: border-color 0.3s;
        }

        .left-clues {
            width: auto;
            min-width: 120px;
            height: 34px;
            text-align: right;
            padding-right: 10px;
            border: none;
        }
        
        .top-clues td {
            width: 34px;
            height: auto;
            min-height: 130px;
            vertical-align: bottom;
            padding: 5px 2px;
            border: none;
        }
        
        .grid td {
            width: 32px;
            height: 32px;
            transition: background-color 0.2s ease;
        }

        .grid td.filled {
            background-color: var(--filled-color);
        }

        .grid td.empty {
            background-color: var(--empty-color);
        }
        
        .controls-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 1.5em;
            padding: 1em;
            background-color: rgba(0,0,0,0.05);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5em;
        }
        
        .control-group label {
            font-weight: 500;
            color: var(--primary-color);
            text-shadow: 0 0 2px var(--primary-glow);
            transition: color 0.3s, text-shadow 0.3s;
        }

        input[type="number"], .clue-input, #theme-select {
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-color);
            border-radius: 6px;
            padding: 8px;
            font-family: var(--font-main);
            text-align: center;
            transition: all 0.3s;
            box-sizing: border-box;
        }
        
        input[type="number"] {
             width: 50px;
        }

        input[type="number"]:focus, .clue-input:focus, #theme-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--primary-glow);
        }
        
        .left-clues .clue-input {
            width: 100%;
        }
        
        .top-clues .clue-input {
            width: 100%;
            height: 120px;
            padding: 8px 4px;
            line-height: 1.5;
            resize: none; 
            white-space: pre-wrap;
            text-align: center;
        }

        #solveBtn {
            background-color: var(--primary-color);
            color: var(--container-bg);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1em;
            font-family: var(--font-display);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 0 8px var(--primary-glow);
        }

        #solveBtn:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 15px var(--primary-glow);
        }
        
        #solveBtn:active {
            transform: translateY(1px);
        }
        
        #solveBtn:disabled {
            background-color: #555;
            color: #999;
            cursor: not-allowed;
            box-shadow: none;
        }

        #status-message {
            text-align: center;
            color: var(--status-color);
            font-style: italic;
            height: 1.2em;
            margin-top: 1.5em;
            text-shadow: 0 0 3px var(--primary-glow);
            transition: color 0.3s, text-shadow 0.3s;
        }
        
        input[type="color"] {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            padding: 0;
            border-radius: 8px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>A-Cool Nonogram Solver</h2>

        <div class="controls-wrapper">
            <div class="control-group">
                <label for="width">Width:</label>
                <input type="number" id="width" value="10" min="1">
                <label for="height">Height:</label>
                <input type="number" id="height" value="10" min="1">
            </div>
            <div class="control-group">
                <label for="theme-select">Theme:</label>
                <select id="theme-select">
                    <option value="plain">Plain</option>
                    <option value="plain-dark">Plain Dark</option>
                    <option value="neon-dark" selected>Neon Dark</option>
                    <option value="neon-light">Neon Light</option>
                </select>
            </div>
            <div class="control-group">
                <label for="filledColor">Filled:</label>
                <input type="color" id="filledColor" value="#ff00e5">
                <label for="emptyColor">Empty:</label>
                <input type="color" id="emptyColor" value="#222222">
            </div>
            <div class="control-group">
                 <button id="solveBtn">Solve!</button>
            </div>
        </div>
        
        <p id="status-message"></p>

        <div id="puzzle-container"></div>
    </div>
    
    <script>
        // --- UI Logic ---
        function createTable(width, height) {
            const container = document.getElementById('puzzle-container');
            container.innerHTML = '';
            const table = document.createElement('table');
            
            const topCluesTbody = document.createElement('tbody');
            topCluesTbody.className = 'top-clues';
            
            const topCluesTr = document.createElement('tr');
            const corner = document.createElement('td');
            corner.style.border = 'none';
            topCluesTr.appendChild(corner);
            for (let j = 0; j < width; j++) {
                const td = document.createElement('td');
                td.innerHTML = `<textarea class="clue-input" data-col="${j}" placeholder="e.g.&#10;1&#10;2"></textarea>`;
                topCluesTr.appendChild(td);
            }
            topCluesTbody.appendChild(topCluesTr);
            table.appendChild(topCluesTbody);

            const gridTbody = document.createElement('tbody');
            gridTbody.className = 'grid';
            for (let i = 0; i < height; i++) {
                const tr = document.createElement('tr');
                
                const leftClueTd = document.createElement('td');
                leftClueTd.className = 'left-clues';
                leftClueTd.innerHTML = `<input type="text" class="clue-input" data-row="${i}" placeholder="e.g. 3 1">`;
                tr.appendChild(leftClueTd);

                for (let j = 0; j < width; j++) {
                    const td = document.createElement('td');
                    td.id = `cell-${i}-${j}`;
                    tr.appendChild(td);
                }
                gridTbody.appendChild(tr);
            }
            table.appendChild(gridTbody);
            
            container.appendChild(table);
        }

        function getCluesFromUI() {
            const width = parseInt(document.getElementById('width').value);
            const height = parseInt(document.getElementById('height').value);
            const clues = {
                rows: Array(height).fill(null).map(() => []),
                cols: Array(width).fill(null).map(() => [])
            };

            document.querySelectorAll('.left-clues input').forEach(input => {
                const row = parseInt(input.dataset.row);
                const values = input.value.trim().split(/[\s,]+/).map(Number).filter(n => n > 0);
                if (values.length > 0) clues.rows[row] = values;
            });
            
            document.querySelectorAll('.top-clues textarea').forEach(input => {
                const col = parseInt(input.dataset.col);
                const values = input.value.trim().split(/[\s,]+/).map(Number).filter(n => n > 0);
                if (values.length > 0) clues.cols[col] = values;
            });
            return clues;
        }

        function clearSolution() {
            const gridCells = document.querySelectorAll('.grid td');
            gridCells.forEach(cell => {
                cell.classList.remove('filled', 'empty');
            });
        }

        function drawSolution(board) {
            if (!board) {
                return false;
            }
            for (let i = 0; i < board.length; i++) {
                for (let j = 0; j < board[i].length; j++) {
                    const cell = document.getElementById(`cell-${i}-${j}`);
                    if (cell) {
                         if (board[i][j] === 1) {
                            cell.classList.add('filled');
                        } else {
                            cell.classList.add('empty');
                        }
                    }
                }
            }
            return true;
        }
        
        function setup() {
            const widthInput = document.getElementById('width');
            const heightInput = document.getElementById('height');
            const solveBtn = document.getElementById('solveBtn');
            const statusMsg = document.getElementById('status-message');
            const filledColorInput = document.getElementById('filledColor');
            const emptyColorInput = document.getElementById('emptyColor');
            const themeSelect = document.getElementById('theme-select');
            
            let solverWorker;

            const themes = {
                'plain': { '--filled-color': '#333333', '--empty-color': '#FFFFFF' },
                'plain-dark': { '--filled-color': '#f8f9fa', '--empty-color': '#495057' },
                'neon-dark': { '--filled-color': '#ff00e5', '--empty-color': '#222222' },
                'neon-light': { '--filled-color': '#ff00e5', '--empty-color': '#e9ecef' }
            };

            function applyTheme(themeName) {
                document.body.className = `theme-${themeName}`;
                const themeColors = themes[themeName];
                if (themeColors) {
                    document.body.style.setProperty('--filled-color', themeColors['--filled-color']);
                    document.body.style.setProperty('--empty-color', themeColors['--empty-color']);
                    filledColorInput.value = themeColors['--filled-color'];
                    emptyColorInput.value = themeColors['--empty-color'];
                }
            }
            
            function updateGrid(){
                 createTable(
                    parseInt(widthInput.value),
                    parseInt(heightInput.value)
                );
                document.querySelectorAll('.top-clues textarea').forEach(textarea => {
                    textarea.addEventListener('input', (e) => {
                        const el = e.target;
                        const originalValue = el.value;
                        const newValue = originalValue.replace(/ /g, '\n');
                        if (newValue !== originalValue) {
                            const cursorPos = el.selectionStart;
                            el.value = newValue;
                            el.setSelectionRange(cursorPos, cursorPos);
                        }
                    });
                });
            }
            
            widthInput.addEventListener('input', updateGrid);
            heightInput.addEventListener('input', updateGrid);
            
            themeSelect.addEventListener('change', (e) => applyTheme(e.target.value));
            
            filledColorInput.addEventListener('input', (e) => {
                document.body.style.setProperty('--filled-color', e.target.value);
            });
            emptyColorInput.addEventListener('input', (e) => {
                document.body.style.setProperty('--empty-color', e.target.value);
            });
            
            const solverCode = `
                function solve(clues) {
                    const height = clues.rows.length;
                    const width = clues.cols.length;
                    let board = Array(height).fill(null).map(() => Array(width).fill(-1));

                    const rowPossibilities = clues.rows.map((clue, i) => generatePossibilities(clue, width));

                    function generatePossibilities(clue, length) {
                        const memo = {};
                        function _generate(clue, length) {
                            const key = clue.join(',') + '|' + length;
                            if (key in memo) return memo[key];
                            if (clue.length === 0) return [Array(length).fill(0)];
                            const possibilities = [];
                            const c = clue[0];
                            const restClue = clue.slice(1);
                            const minLengthForRest = restClue.reduce((a, b) => a + b, 0) + restClue.length;
                            for (let i = 0; i <= length - minLengthForRest - c; i++) {
                                const prefix = Array(i).fill(0);
                                const block = Array(c).fill(1);
                                const separator = restClue.length > 0 ? [0] : [];
                                const restPossibilities = _generate(restClue, length - i - c - separator.length);
                                for (const rest of restPossibilities) {
                                    possibilities.push([...prefix, ...block, ...separator, ...rest]);
                                }
                            }
                            memo[key] = possibilities;
                            return possibilities;
                        }
                        return _generate(clue, length);
                    }

                    function isConsistent(board, row) {
                        const isLastRow = (row === height - 1);
                        for (let j = 0; j < width; j++) {
                            let currentBlocks = [];
                            let currentLength = 0;
                            for (let i = 0; i <= row; i++) {
                                if (board[i][j] === 1) {
                                    currentLength++;
                                } else if (currentLength > 0) {
                                    currentBlocks.push(currentLength);
                                    currentLength = 0;
                                }
                            }
                            if (currentLength > 0) currentBlocks.push(currentLength);

                            const colClue = clues.cols[j];
                            if (isLastRow) {
                                if (currentBlocks.length !== colClue.length) return false;
                                for (let k = 0; k < currentBlocks.length; k++) {
                                    if (currentBlocks[k] !== colClue[k]) return false;
                                }
                            } else {
                                if (currentBlocks.length > colClue.length) return false;
                                for (let k = 0; k < currentBlocks.length; k++) {
                                    if (currentBlocks[k] > colClue[k]) return false;
                                }
                            }
                        }
                        return true;
                    }

                    function solveRecursive(row) {
                        if (row === height) return true;
                        for (const possibility of rowPossibilities[row]) {
                            board[row] = possibility;
                            if (isConsistent(board, row)) {
                                if (solveRecursive(row + 1)) return true;
                            }
                        }
                        board[row] = Array(width).fill(-1);
                        return false;
                    }

                    return solveRecursive(0) ? board : null;
                }

                self.onmessage = function(e) {
                    const clues = e.data;
                    const result = solve(clues);
                    self.postMessage(result);
                };
            `;

            const blob = new Blob([solverCode], { type: 'application/javascript' });
            const workerURL = URL.createObjectURL(blob);

            solveBtn.addEventListener('click', () => {
                if (solverWorker) {
                    solverWorker.terminate();
                }
                
                clearSolution(); 
                const clues = getCluesFromUI();

                const rowSum = clues.rows.flat().reduce((a, b) => a + b, 0);
                const colSum = clues.cols.flat().reduce((a, b) => a + b, 0);

                if (rowSum !== colSum) {
                    statusMsg.textContent = "No solution found. Clue sums do not match.";
                    return;
                }

                solverWorker = new Worker(workerURL);
                statusMsg.textContent = "Solving...";
                solveBtn.disabled = true;

                solverWorker.onmessage = (e) => {
                    const solution = e.data;
                    const success = drawSolution(solution);
                    
                    if (success) {
                        statusMsg.textContent = "Solved!";
                    } else {
                        statusMsg.textContent = "No solution found. The clues may be inconsistent.";
                    }
                    
                    solveBtn.disabled = false;
                    solverWorker.terminate();
                };

                solverWorker.postMessage(clues);
            });
            
            // Initial setup
            applyTheme(themeSelect.value);
            updateGrid();
        }

        window.onload = setup;

    </script>
</body>
</html>
